<app-widget [title]="'Defensive Coverage'">
  @if (isAgainstTeam()) {
    <right-header>
      <div class="toggles-container">
        @if (secondTeamHasTeraBlast()) {
          <mat-slide-toggle [checked]="considerTeraBlast()" (change)="considerTeraBlast.set($event.checked)" [labelPosition]="'before'" data-cy="consider-tera-blast-toggle-defensive"> Tera Blast </mat-slide-toggle>
        }
        <mat-slide-toggle [checked]="considerTeraType()" (change)="considerTeraType.set($event.checked)" [labelPosition]="'before'" data-cy="consider-tera-type-toggle"> Tera Type </mat-slide-toggle>
      </div>
    </right-header>
  } @else {
    <right-header>
      <mat-slide-toggle [checked]="considerTeraType()" (change)="considerTeraType.set($event.checked)" [labelPosition]="'before'" data-cy="consider-tera-type-toggle"> Tera Type </mat-slide-toggle>
    </right-header>
  }

  @if (hasValidTeamMembers()) {
    <div class="table-container" data-cy="defensive-coverage-table-container">
      <table class="coverage-table" data-cy="defensive-coverage-table">
        <thead>
          <tr>
            <th class="type-header"></th>
            @if (coverageData().length > 0) {
              @for (pokemonData of coverageData()[0].pokemonData; track pokemonData.pokemon.id) {
                <th class="pokemon-header" data-cy="pokemon-header">
                  <div class="pokemon-container">
                    <img class="pokemon-image-small" src="assets/sprites/pokemon-sv/{{ pokemonData.pokemon.name }}.png" [alt]="pokemonData.pokemon.name" data-cy="pokemon-image-small" />
                    @if (considerTeraType() && pokemonData.pokemon.teraType) {
                      <span class="tera-type-label">{{ pokemonData.pokemon.teraType }}</span>
                    }
                  </div>
                </th>
              }
            }
            <th class="total-header" data-cy="total-header-weak">Total Weak</th>
            <th class="total-header" data-cy="total-header-resist">Total Resist</th>
          </tr>
        </thead>
        <tbody>
          @for (row of coverageData(); track getRowKey(row)) {
            @if (row) {
              <tr>
                <td class="type-cell">
                  @if (isAgainstTeam()) {
                    @if (getTargetPokemon(row)) {
                      <div class="pokemon-container">
                        <img class="pokemon-image-small" src="assets/sprites/pokemon-sv/{{ getTargetPokemon(row)!.name }}.png" [alt]="getTargetPokemon(row)!.name" data-cy="pokemon-image-small" />
                        @if (considerTeraBlast() && hasTeraBlast(getTargetPokemon(row)!) && getPokemonTeraType(getTargetPokemon(row)!)) {
                          <span class="tera-blast-label">Tera Blast {{ getPokemonTeraType(getTargetPokemon(row)!) }}</span>
                        }
                      </div>
                    }
                  } @else {
                    @if (getMoveType(row)) {
                      <app-type-combo-box [type1]="getTypeName(getMoveType(row)!)" [centralized]="true" [reduced]="true" />
                    }
                  }
                </td>
                @for (pokemonData of row.pokemonData; track pokemonData.pokemon.id) {
                  <td class="effectiveness-cell" [ngClass]="getCellClass(pokemonData.effectiveness)" data-cy="effectiveness-cell">
                    @if (pokemonData.formatted) {
                      {{ pokemonData.formatted }}
                    }
                  </td>
                }
                <td class="total-cell" [ngClass]="getTotalWeakClass(row.totalWeak)" data-cy="total-cell-weak">
                  {{ row.totalWeak }}
                </td>
                <td class="total-cell" [ngClass]="getTotalResistClass(row.totalResist)" data-cy="total-cell-resist">
                  {{ row.totalResist }}
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>
  }
</app-widget>
